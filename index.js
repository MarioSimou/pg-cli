!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pg-sql",[],e):"object"==typeof exports?exports["pg-sql"]=e():t["pg-sql"]=e()}(global,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="./src/index.js")}({"./src/index.js":function(t,e,n){"use strict";n.r(e);const r="all",o="and",s="as",c="equal",u="unequal",a="or",i="in",l="any",f="gt",m="gte",h="lt",p="lte",_="limit",d="offset",b="match",$="matchi",y="is",g="not",N="null",w="orderBy",j="asc",E="desc",v="groupBy",C="max",A="min",O="count",T="avg",S="sum",x="cast",I="having",M="between";var R={name:r,constructor:function(t){return["*"]}},k={name:"insertInto",constructor:function(t){const[e]=t;return["INSERT INTO"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}},L={name:"returning",constructor:function(t){const e=t.map(t=>t._colName).join(",");return e?["RETURNING "+e]:["RETURNING"]}},P={name:"values",constructor:function(t){const e=[],n=[],r=new Set;for(let o of t){const t=`(${new Array(o.length).fill("$").join(",")})`;e.push(t),o.forEach(t=>{r.has(t._colName)||r.add(t._colName),n.push(...t._params),t._flush()})}return[`(${Array.from(r).join(",")}) VALUES ${e.join(",")}`,n]}},U={name:"select",constructor:function(t){const e=[];for(let n of t){const t=n._monitor.length;if(0!==t)for(let r of n._monitor){const o=n._commands.get(r).shift();switch(r){case x:e.push(n._fullColName+o);break;case s:if(t>1){const t=e.pop();e.push(t+" "+o)}else e.push(n._fullColName+" "+o);break;case S:case C:case A:case T:case O:e.push(o+"("+n._fullColName+")");break;default:e.push(o)}}else e.push(n._fullColName)}return t.forEach(t=>t._flush()),[`SELECT ${e.join(",")||"*"}`]}},B={name:"from",constructor:function(t){const[e]=t;return["FROM "+(e?`${e.schema}."${e.table}"`:`${this._schema}."${this._table}"`)]}},D={name:"update",constructor:function(t){const[e]=t;return["UPDATE"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}},q={name:"set",constructor:function(t){const e=[],n=[];for(let r of t){const t=r._params.pop(),[o]=Array.from(r._commands.values());n.push(t),e.push(r._colName+o+"$"),r._flush()}return[`SET ${e.join(",")}`,n]}},F={name:"deleteFrom",constructor:function(t){const[e]=t;return["DELETE FROM"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}};const G=(t,e,n,r)=>(e.push(...t._monitor.reduce((e,n)=>[...e,t._commands.get(n).shift()],[])),r.push(...t._monitor.reduce((e,n)=>[...e,[n,t._fullColName]],[])),n.push(...t._params),t._nestedColumn&&G(t._nestedColumn,e,n,r),t._flush(),[e,n,r]);var Y={name:"where",constructor:function(t){const[e]=t,[n,s,_]=G(e,[],[],[]),d=_.length,w=[];for(let t=0;t<d;t++){const[e,s]=_[t],j=n[t];if(j)switch(e){case r:case l:case i:case y:case g:case N:0==t?w.push(s+" "+j):w.push(j);break;case o:case a:if(t===d-1){const t=w.pop();w.push(j+" "+t)}else w.push(j);break;case M:w.push(s+" "+j+" $ AND $");break;case c:case u:case h:case p:case f:case m:case b:case $:w.push(s+j+"$");break;default:w.push(s+j)}}return[`WHERE ${w.join(" ")}`,s]}},V=(()=>({name:_,constructor:function(t){return["LIMIT $",t]}}))(),H=(()=>({name:d,constructor:function(t){return["OFFSET $",t]}}))(),W=(n("fs"),{name:w,constructor:function(t){const e=[];for(let n of t){const[t]=Array.from(n._commands.values());e.push(n._fullColName+" "+t),n._flush()}return["ORDER BY "+e.join(",")]}}),X={name:v,constructor:function(t){return["GROUP BY "+t.map(t=>t._fullColName).join(",")]}},z={name:I,constructor:function(t){const[e]=t,[n,r,s]=G(e,[],[],[]),i=s.length,l=[];for(let t=0;t<i;t++){const[e,r]=s[t],i=n[t];if(!i)continue;let _;switch(e){case O:case A:case C:case T:case S:l.push(i+"("+r+")");break;case M:_=l.pop(),l.push(_+" "+i+" $ AND $");break;case f:case m:case h:case p:case c:case u:_=l.pop(),l.push(_+i+"$");break;case o:case a:_=l.pop(),l.push(i,_);break;default:_=l.pop(),l.push(_+" "+i)}}return[`HAVING ${l.join(" ")}`,r]}},J={name:s,constructor:function(...t){return[`as ${t[0]}`]}},K={name:c,constructor:function(...t){return["=",t]}},Q={name:u,constructor:function(...t){return["<>",t]}},Z={name:f,constructor:function(...t){return[">",t]}},tt={name:m,constructor:function(...t){return[">=",t]}},et={name:h,constructor:function(...t){return["<",t]}},nt={name:p,constructor:function(...t){return["<=",t]}},rt={name:o,constructor:function(t){return this._fullColName!==t._fullColName&&(this._nestedColumn=t),["AND"]}},ot={name:a,constructor:function(t){return this._fullColName!==t._fullColName&&(this._nestedColumn=t),["OR"]}},st={name:i,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`IN(${e})`,n];default:var e;return[`IN(${e=new Array(t.length).fill("$").join(",")})`,t]}}},ct={name:l,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`ANY(${e})`,n];default:var e;return[`ANY(${e=new Array(t.length).fill("$").join(",")})`,t]}}},ut={name:r,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`ALL(${e})`,n];default:var e;return[`ALL(${e=new Array(t.length).fill("$").join(",")})`,t]}}},at={name:b,constructor:function(...t){return["~",t]}},it={name:$,constructor:function(...t){return["~*",t]}},lt={name:y,constructor:function(t){return["IS"]}},ft={name:g,constructor:function(t){return["NOT"]}},mt={name:N,constructor:function(t){return["NULL"]}},ht={name:j,constructor:function(t){return["ASC"]}},pt={name:E,constructor:function(t){return["DESC"]}},_t={name:S,constructor:function(){return["SUM"]}},dt={name:C,constructor:function(){return["MAX"]}},bt={name:A,constructor:function(){return["MIN"]}},$t={name:T,constructor:function(){return["AVG"]}},yt={name:O,constructor:function(){return["COUNT"]}},gt={name:x,constructor:function(t){return["::"+t]}},Nt={name:M,constructor:function(...t){if(2!==t.length)throw new Error("Expected 2 paramaeters for between in");return["BETWEEN",t]}};const wt=function({colName:t,table:e,schema:n}){this._colName=t,this._fullColName=`${n}."${e}"."${t}"`,this._commands=new Map,this._params=[],this._monitor=[],this._nestedColumn=null;Object.defineProperty(this,t,{get:function(){return this}})};wt.set=function(t){this.prototype[t.name]=function(...e){const[n,r]=t.constructor.call(this,...e);return this._commands.get(t.name)||this._commands.set(t.name,[]),n&&this._commands.get(t.name).push(n),r&&this._params.push(...r),this._monitor.push(t.name),this}},wt.prototype._flush=function(){this._commands=new Map,this._nestedColumn=null,this._params=[],this._monitor=[]},wt.set(J),wt.set(K),wt.set(Q),wt.set(Z),wt.set(tt),wt.set(et),wt.set(nt),wt.set(rt),wt.set(ot),wt.set(st),wt.set(ct),wt.set(ut),wt.set(at),wt.set(it),wt.set(lt),wt.set(ft),wt.set(mt),wt.set(pt),wt.set(ht),wt.set(_t),wt.set(bt),wt.set(dt),wt.set(yt),wt.set($t),wt.set(gt),wt.set(Nt);var jt=wt;const Et=function({table:t,schema:e,columns:n}){if(!t)throw new Error("please specify a table");if(!e)throw new Error("please specify a schema");if(!n)throw new Error("please specify columns");if("string"!=typeof t||"string"!=typeof e)throw new Error("table and schema should be strings");if(!1 instanceof Array)throw new Error("columns should be table");this._statement={select:null,from:null,where:null,update:null,set:null,insertInto:null,values:null,deleteFrom:null,having:null,groupBy:null,orderBy:null,all:null,limit:null,offset:null,returning:null},this._params=[],this._monitor=[],this._table=t,this._schema=e,this._columns=n.reduce((t,e)=>({...t,[e]:new jt({colName:e,table:this._table,schema:this._schema})}),{})};Et.set=function(t){if(!t||!t.name||"string"!=typeof t.name)throw new Error("not valid type");if(!t||!t.constructor||"function"!=typeof t.constructor)throw new Error("no valid type");this.prototype[t.name]=function(...e){const[n,r]=t.constructor.call(this,e,t.name);return n&&(this._statement[t.name]=n),r&&this._params.push(...r),this._monitor.push(t.name),this}};Object.defineProperty(Et.prototype,"end",{get:function(){const t=this._params,e=this._monitor,n=new Map(Object.entries(this._statement));let r=1;const o=/[$]/,s=[];for(let t of e){let e=n.get(t);if(!o.test(e)){s.push(e);continue}const c=[];e=e.replace(/[$]\d+/g,"$");for(let t of e.split(""))o.test(t)?(c.push("$"+r),++r):c.push(t);s.push(c.join(""))}return this._statement=[],this._params=[],this._monitor=[],[s.join(" "),t]}}),Object.defineProperty(Et.prototype,"columns",{get:function(){return this._columns}}),Et.set(k),Et.set(P),Et.set(L),Et.set(R),Et.set(U),Et.set(B),Et.set(D),Et.set(q),Et.set(F),Et.set(Y),Et.set(H),Et.set(V),Et.set(W),Et.set(X),Et.set(z);var vt=Et;n.d(e,"Table",function(){return vt}),n.d(e,"Column",function(){return jt})},fs:function(t,e){t.exports=require("fs")}})});