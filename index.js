!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pg-sql",[],e):"object"==typeof exports?exports["pg-sql"]=e():t["pg-sql"]=e()}(global,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="./src/index.js")}({"./src/index.js":function(t,e,n){"use strict";n.r(e);const o="all",r="where",s="and",c="as",u="equal",a="unequal",i="or",l="in",f="any",m="gt",h="gte",p="lt",_="lte",d="limit",$="offset",b="match",g="matchi",y="is",N="not",v="null",j="orderBy",w="asc",E="desc",C="groupBy",A="max",O="min",T="count",S="avg",x="sum",I="cast",M="having",R="between";var k={name:o,constructor:function(t){return["*"]}},L={name:"insertInto",constructor:function(t){const[e]=t;return["INSERT INTO"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}};const P=({_col:t})=>t.to===t.from?`"${t.to}"`:`"${t.to}" as "${t.from}"`;var U={name:"returning",constructor:function(t){const e=t.map(P).join(",");return e?["RETURNING "+e]:["RETURNING"]}},B={name:"values",constructor:function(t){const e=[],n=[],o=new Set;for(let r of t){const t=`(${new Array(r.length).fill("$").join(",")})`;e.push(t),r.forEach(t=>{o.has(t._colName)||o.add(t._colName),n.push(...t._params),t._flush()})}return[`(${Array.from(o).join(",")}) VALUES ${e.join(",")}`,n]}};const D=t=>e=>t?e.to:[e.to,"as",`"${e.from}"`].join(" ");var q={name:"select",constructor:function(t){const e=[];for(let n of t){const t=D(n._commands.has("as")),o=n._monitor.length;if(0!==o)for(let r of n._monitor){const s=n._commands.get(r).shift();switch(r){case I:e.push(t({to:n._fullColName+s,from:n._col.from}));break;case c:if(o>1){const n=e.pop();e.push(t({to:n+" "+s}))}else e.push(t({to:n._fullColName+" "+s}));break;case x:case A:case O:case S:case T:e.push(t({to:s+"("+n._fullColName+")",from:n._col.from}));break;default:e.push(s)}}else e.push(t({to:n._fullColName,from:n._col.from}))}return t.forEach(t=>t._flush()),[`SELECT ${e.join(",")||"*"}`]}},F={name:"from",constructor:function(t){const[e]=t;return["FROM "+(e?`${e.schema}."${e.table}"`:`${this._schema}."${this._table}"`)]}},G={name:"update",constructor:function(t){const[e]=t;return["UPDATE"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}},Y={name:"set",constructor:function(t){const e=[],n=[];for(let o of t){const t=o._params.pop(),[r]=Array.from(o._commands.values());n.push(t),e.push(o._colName+r+"$"),o._flush()}return[`SET ${e.join(",")}`,n]}},V={name:"deleteFrom",constructor:function(t){const[e]=t;return["DELETE FROM"+(e?` ${e.schema}."${e.table}"`:` ${this._schema}."${this._table}"`)]}};const H=(t,e,n,o)=>(e.push(...t._monitor.reduce((e,n)=>[...e,t._commands.get(n).shift()],[])),o.push(...t._monitor.reduce((e,n)=>[...e,[n,t._fullColName]],[])),n.push(...t._params),t._nestedColumn&&H(t._nestedColumn,e,n,o),t._flush(),[e,n,o]),W=function(t){return function(e,n,...o){n||(n=e),Object.defineProperty(this,e,{get:t.bind(this,n,...o)})}},X=W((function(t){return this["_"+t]}));var z={name:r,constructor:function(t){const[e]=t,[n,r,c]=H(e,[],[],[]),d=c.length,$=[];for(let t=0;t<d;t++){const[e,r]=c[t],j=n[t];if(j)switch(e){case o:case f:case l:case y:case N:case v:0==t?$.push(r+" "+j):$.push(j);break;case s:case i:if(t===d-1){const t=$.pop();$.push(j+" "+t)}else $.push(j);break;case R:$.push(r+" "+j+" $ AND $");break;case u:case a:case p:case _:case m:case h:case b:case g:$.push(r+j+"$");break;default:$.push(r+j)}}return[`WHERE ${$.join(" ")}`,r]}},J={name:d,constructor:function(t){return["LIMIT $",t]}},K={name:$,constructor:function(t){return["OFFSET $",t]}},Q=(n("fs"),{name:j,constructor:function(t){const e=[];for(let n of t){const[t]=Array.from(n._commands.values());e.push(n._fullColName+" "+t),n._flush()}return["ORDER BY "+e.join(",")]}}),Z={name:C,constructor:function(t){return["GROUP BY "+t.map(t=>t._fullColName).join(",")]}},tt={name:M,constructor:function(t){const[e]=t,[n,o,r]=H(e,[],[],[]),c=r.length,l=[];for(let t=0;t<c;t++){const[e,o]=r[t],c=n[t];if(!c)continue;let f;switch(e){case T:case O:case A:case S:case x:l.push(c+"("+o+")");break;case R:f=l.pop(),l.push(f+" "+c+" $ AND $");break;case m:case h:case p:case _:case u:case a:f=l.pop(),l.push(f+c+"$");break;case s:case i:f=l.pop(),l.push(c,f);break;default:f=l.pop(),l.push(f+" "+c)}}return[`HAVING ${l.join(" ")}`,o]}},et={name:c,constructor:function(...t){return[`as "${t[0]}"`]}},nt={name:u,constructor:function(...t){return["=",t]}},ot={name:a,constructor:function(...t){return["<>",t]}},rt={name:m,constructor:function(...t){return[">",t]}},st={name:h,constructor:function(...t){return[">=",t]}},ct={name:p,constructor:function(...t){return["<",t]}},ut={name:_,constructor:function(...t){return["<=",t]}},at={name:s,constructor:function(t){return this._fullColName!==t._fullColName&&(this._nestedColumn=t),["AND"]}},it={name:i,constructor:function(t){return this._fullColName!==t._fullColName&&(this._nestedColumn=t),["OR"]}},lt={name:l,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`IN(${e})`,n];default:var e;return[`IN(${e=new Array(t.length).fill("$").join(",")})`,t]}}},ft={name:f,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`ANY(${e})`,n];default:var e;return[`ANY(${e=new Array(t.length).fill("$").join(",")})`,t]}}},mt={name:o,constructor:function(...t){switch(t.some(t=>2===t.length)){case!0:var[e,n]=t[0];return[`ALL(${e})`,n];default:var e;return[`ALL(${e=new Array(t.length).fill("$").join(",")})`,t]}}},ht={name:b,constructor:function(...t){return["~",t]}},pt={name:g,constructor:function(...t){return["~*",t]}},_t={name:y,constructor:function(t){return["IS"]}},dt={name:N,constructor:function(t){return["NOT"]}},$t={name:v,constructor:function(t){return["NULL"]}},bt={name:w,constructor:function(t){return["ASC"]}},gt={name:E,constructor:function(t){return["DESC"]}},yt={name:x,constructor:function(){return["SUM"]}},Nt={name:A,constructor:function(){return["MAX"]}},vt={name:O,constructor:function(){return["MIN"]}},jt={name:S,constructor:function(){return["AVG"]}},wt={name:T,constructor:function(){return["COUNT"]}},Et={name:I,constructor:function(t){return["::"+t]}},Ct={name:R,constructor:function(...t){if(2!==t.length)throw new Error("Expected 2 paramaeters for between in");return["BETWEEN",t]}};const At=function(){return this},Ot=function({column:t,table:e,schema:n}){this._colName=t.to,this._col=t,this._fullColName=`${n}."${e}"."${t.to}"`,this._commands=new Map,this._params=[],this._monitor=[],this._nestedColumn=null,W(At).call(this,t.from)};Ot.set=function(t){this.prototype[t.name]=function(...e){const[n,o]=t.constructor.call(this,...e);return this._commands.get(t.name)||this._commands.set(t.name,[]),n&&this._commands.get(t.name).push(n),o&&this._params.push(...o),this._monitor.push(t.name),this}},Ot.prototype._flush=function(){this._commands=new Map,this._nestedColumn=null,this._params=[],this._monitor=[]},Ot.set(et),Ot.set(nt),Ot.set(ot),Ot.set(rt),Ot.set(st),Ot.set(ct),Ot.set(ut),Ot.set(at),Ot.set(it),Ot.set(lt),Ot.set(ft),Ot.set(mt),Ot.set(ht),Ot.set(pt),Ot.set(_t),Ot.set(dt),Ot.set($t),Ot.set(gt),Ot.set(bt),Ot.set(yt),Ot.set(vt),Ot.set(Nt),Ot.set(wt),Ot.set(jt),Ot.set(Et),Ot.set(Ct);var Tt=Ot;const St=t=>t instanceof Object&&t.from&&t.to,xt=function({table:t,schema:e="public",columns:n}){if(!(this instanceof xt))return new xt({table:t,schema:e,columns:n});if(!t||"string"!=typeof t)throw new Error("please specify a table as a string");if(!n.every(St))throw new Error("please provide a valid column structure");this._statement={select:null,from:null,where:null,update:null,set:null,insertInto:null,values:null,deleteFrom:null,having:null,groupBy:null,orderBy:null,all:null,limit:null,offset:null,returning:null},this._params=[],this._monitor=[],this._table=t,this._schema=e,this._columns=n.reduce((t,e)=>{const n=new Tt({column:e,table:this._table,schema:this._schema});return t[e.to]=n,t[e.from]=n,t},{}),X.call(this,"name","table"),X.call(this,"schema"),X.call(this,"columns"),W(It).call(this,"end")};function It(){const t=this._params,e=this._monitor,n=new Map(Object.entries(this._statement));let o=1;const r=/[$]/,s=[];for(let t of e){let e=n.get(t);if(!r.test(e)){s.push(e);continue}const c=[];e=e.replace(/[$]\d+/g,"$");for(let t of e.split(""))r.test(t)?(c.push("$"+o),++o):c.push(t);s.push(c.join(""))}return this._statement=[],this._params=[],this._monitor=[],[s.join(" "),t]}xt.set=function(t){if(!t||!t.name||"string"!=typeof t.name)throw new Error("not valid type");if(!t||!t.constructor||"function"!=typeof t.constructor)throw new Error("no valid type");this.prototype[t.name]=function(...e){const[n,o]=t.constructor.call(this,e,t.name);return n&&(this._statement[t.name]=n),o&&this._params.push(...o),this._monitor.push(t.name),this}},xt.set(L),xt.set(B),xt.set(U),xt.set(k),xt.set(q),xt.set(F),xt.set(G),xt.set(Y),xt.set(V),xt.set(z),xt.set(K),xt.set(J),xt.set(Q),xt.set(Z),xt.set(tt);var Mt=xt;n.d(e,"Table",(function(){return Mt})),n.d(e,"Column",(function(){return Tt}))},fs:function(t,e){t.exports=require("fs")}})}));